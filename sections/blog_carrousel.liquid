{% capture blog_id %}{{ section.settings.blog_id }}{% endcapture %}
{% capture tag %}{{ section.settings.tag }}{% endcapture %}
{% assign counter = 1 %}
{% assign limit = section.settings.limit | plus: 0 %}

{% if section.settings.max_width != empty %}
  <style>
    #{{ section.id }}{
      max-width: {{section.settings.max_width}}px;
    }
  </style>
{% endif %}

<style>
  #{{ section.id }}{
    padding-top: {{ section.settings.mobile-p_top }}px;
    padding-bottom: {{ section.settings.mobile-p_bottom }}px;
    padding-left: {{ section.settings.mobile-p_left }}px;
    padding-right: {{ section.settings.mobile-p_right }}px;
    font-size: {{ section.settings.mobile-font_size }}px;
    color: {{ section.settings.text_color }};
    background: {{ section.settings.bg_color }};
    width: 100%;
    margin: 0 auto;
  }

  #{{ section.id }} .section_header{
    text-align:center;
    font-size: calc({{ section.settings.mobile-font_size }}px + 5px);
    color: {{ section.settings.text_color }};
    margin:0;
    padding:0;
    margin-bottom:10px;
    font-weight:400;
    line-height:100%;
  }

  #{{ section.id }} .section_container{
    width:100%;
    position:relative;
  }

  #{{ section.id }} .articles_container{
    width:100%;
    display:flex;
    flex-direction:row;
    flex-wrap:nowrap;
    justify-content:center;
    align-items:stretch;
    overflow-x:auto;
  }

  #{{ section.id }} .articles_container.mobile_start{
    justify-content:flex-start;
  }

  #{{ section.id }} .articles_container.always_start{
    justify-content:flex-start!important;
  }

  /* Hide scrollbar for Chrome, Safari and Opera */
  #{{ section.id }} .articles_container::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  #{{ section.id }} .articles_container{
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

  #{{ section.id }} .articles_container > .article{
    width:calc(100% / 2 - 10px);
    min-width:calc(100% / 2 - 10px);
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: stretch;
    margin-right:10px;
    border:0.5px solid #afafaf
  }

  #{{ section.id }} .articles_container > .article > .article_img{
    width:100%;
    height:auto;
    aspect-ratio:16/9;
    object-fit:cover;
    margin-bottom:10px;
  }

  #{{ section.id }} .articles_container > .article > .text_container{
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: center;
    height: 100%;
    margin-bottom:10px;
  }

  #{{ section.id }} .articles_container > .article .article_tag{
    color:#C2C2C2;
    font-size:calc({{ section.settings.mobile-font_size }}px - 2px);
    line-height:100%;
    margin:0;
    padding:0;
    margin-bottom:10px;
    text-transform:uppercase;
  }

  #{{ section.id }} .articles_container > .article .article_title{
    color:{{ section.settings.text_color }};
    font-size:{{ section.settings.mobile-font_size }}px;
    line-height:1rem;
    margin:0;
    text-align:center;
    margin-bottom:10px;
    padding:0 3px;
    font-weight:400;
    max-width:300px;
  }
  #{{ section.id }} .articles_container > .article .article_title a{
    color: inherit;
    text-decoration: none;
    line-height: 1.1em;
  }

  #{{ section.id }} .articles_container > .article .article_title > *:hover{
    color:{{ section.settings.text_color }};
    text-decoration:underline;
  }

  #{{ section.id }} .articles_container > .article .read_more{
    color:{{ section.settings.text_color }};
    font-size:calc({{ section.settings.mobile-font_size }}px - 2px);
    line-height:1rem;
    margin:0;
    padding:0;
    text-align:center;
    text-decoration:underline;
    text-transform:uppercase;
    text-underline-offset:0.2rem;
    margin-bottom:5px;
  }

  #{{ section.id }} .articles_container > .article .read_more a{
    color:inherit;
  }

  #{{ section.id }} .articles_container > .article .read_more:hover,
  #{{ section.id }} .articles_container > .article .read_more > *:hover{
    color:{{ section.settings.text_color }};
    text-decoration:none;
  }

  #{{ section.id }} .arrow-container{
    display:none;
    top:calc(50% - 35px);
    position:absolute;
    width:100%;
  }

  #{{ section.id }} .arrow-container > *{
    color: #D0D0D0;
    opacity:0.6;
    position:absolute;
  }

  #{{ section.id }} .arrow-container > * svg{
    width:70px;
  }

  #{{ section.id }} .arrow-container > *:hover{
    opacity:1;
  }

  #{{ section.id }} .arrow-container > .left{
    left:-8px;
    transform:rotate(90deg);
  }

  #{{ section.id }} .arrow-container > .right{
    right:3px;
    transform:rotate(270deg);
  }

  #{{ section.id }} .arrow-container.arrow_mobile{
    display:block;
  }

  @media screen and (min-width:768px){
    /* #{{ section.id }} .arrow-container{
      top:43%;
    } */

    #{{ section.id }} .articles_container > .article{
      width:calc(100% / 3 - 10px);
      min-width:calc(100% / 3 - 10px);
    }
  }

  @media screen and (min-width:992px){
    #{{ section.id }}{
      padding-top: {{ section.settings.desktop-p_top }}px;
      padding-bottom: {{ section.settings.desktop-p_bottom }}px;
      padding-left: {{ section.settings.desktop-p_left }}px;
      padding-right: {{ section.settings.desktop-p_right }}px;
      font-size: {{ section.settings.desktop-font_size }}px;
    }

    #{{ section.id }} .section_header{
      font-size: calc({{ section.settings.desktop-font_size }}px + 5px);
    }

    #{{ section.id }} .articles_container.mobile_start{
      justify-content:center;
    }

    #{{ section.id }} .articles_container.always_start{
      justify-content:flex-start;
    }

    #{{ section.id }} .articles_container > .article .article_tag{
      font-size:calc({{ section.settings.desktop-font_size }}px - 3px);
    }

    #{{ section.id }} .articles_container > .article .article_title{
      font-size:{{ section.settings.desktop-font_size }}px;
    }

    #{{ section.id }} .articles_container > .article .read_more{
      font-size:calc({{ section.settings.desktop-font_size }}px - 3px);
    }

    #{{ section.id }} .arrow-container.arrow_mobile{
      display:none;
    }

    #{{ section.id }} .arrow-container.all_devices{
      display:block;
    }
  }

  @media screen and (min-width:1440px){
    #{{ section.id }} .arrow-container > .left{
      left:-28px;
    }

    #{{ section.id }} .arrow-container > .right{
      right:-17px;
    }
  }
</style>

<section id="{{ section.id }}">
  <h2 class="section_header">{{ section.settings.heading }}</h2>
  <div class="section_container">
    <div class="articles_container {% if limit == 3 %}mobile_start{% endif %} {% if limit >= 4 %}always_start{% endif %}">
      {% paginate blogs[blog_id].articles by 300 %}
        {% for article in blogs[blog_id].articles %}
          {% if article.tags contains tag and counter <= limit %}
            <div class="article">
              {% if article.metafields.global.main_image %}
                <img
                  loading='lazy' src="{{ article.metafields.global.main_image }}"
                  class="lazyload article_img"
                  height="{{ article.metafields.global.main_image.height }}"
                  width="{{ article.metafields.global.main_image.width }}"
                  alt="{{ article.metafields.global.main_image.alt }}"
                >
              {% else %}
                <img
                  loading='lazy' src="{{ article.image.src | image_url }}"
                  class="lazyload article_img"
                  height="{{ article.image.height }}"
                  width="{{ article.image.width }}"
                  alt="{{ article.image.alt }}"
                >
              {% endif %}
              <div class="text_container">
                <p class="article_tag">{{ tag | capitalize }}</p>
                <h3 class="article_title">
                  <a href="{{ article.url }}" target="_blank" title="{{ article.title }}">{{ article.title }}</a>
                </h3>
                <p class="read_more">
                  <a href="{{ article.url }}" target="_blank" title="{{ article.title }}">Read More</a>
                </p>
              </div>
            </div>
            {% assign counter = counter | plus: 1 %}
          {% endif %}
        {% endfor %}
      {% endpaginate %}
    </div>

    <div class="arrow-container {% if limit >= 3 %}arrow_mobile{% endif %} {% if limit >= 4 %}all_devices{% endif %}">
      <span
        class="scroll-arrow left"
        onclick="scrollArrow(this)"
        data-target="articles_container"
        data-direction="left"
        data-speed="50"
        data-distance="500"
        data-step="50"
        >{% render 'icon-caret' %}</span>
      <span
        class="scroll-arrow right"
        onclick="scrollArrow(this)"
        data-target="articles_container"
        data-direction="right"
        data-speed="50"
        data-distance="500"
        data-step="50"
        >{% render 'icon-caret' %}</span>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Blog Carrousel",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section header"
    },
    {
      "type": "blog",
      "id": "blog_id",
      "label": "Blog category"
    },
    {
      "type": "text",
      "id": "tag",
      "label": "Search Tag"
    },
    {
      "type": "text",
      "id": "limit",
      "label": "Limit posts",
      "default": "3"
    },
    {
      "type": "header",
      "content": "Universal Settings"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Colour",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Colour",
      "default": "#FFFFFF"
    },
    {
      "type": "text",
      "label": "Max width",
      "info": "Enter the value in px. Ex: 1400, 1250, ...",
      "id": "max_width"
    },
    {
      "type": "header",
      "content": "Mobile Settings"
    },
    {
      "type": "range",
      "id": "mobile-font_size",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Font Size",
      "default": 12
    },
    {
      "type": "range",
      "id": "mobile-p_top",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile-p_bottom",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile-p_right",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Right",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile-p_left",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Left",
      "default": 0
    },
    {
      "type": "header",
      "content": "Desktop Settings"
    },
    {
      "type": "range",
      "id": "desktop-font_size",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Font Size",
      "default": 18
    },
    {
      "type": "range",
      "id": "desktop-p_top",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Top",
      "default": 0
    },
    {
      "type": "range",
      "id": "desktop-p_bottom",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "desktop-p_right",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Right",
      "default": 0
    },
    {
      "type": "range",
      "id": "desktop-p_left",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Padding Left",
      "default": 0
    }
  ]
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
